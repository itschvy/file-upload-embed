<html>

<head>
  <meta charset="UTF-8">
  <title>Simple CloudWok upload form</title>
</head>

<body>

  <h1>Example of a simple upload form</h1>
  <p>
    <ul>
      <li>Enter your own wok id (sign up at <a href="https://www.cloudwok.com">https://www.cloudwok.com</a>)</li>
      <li>Run this example page, e.g. with <a href="https://github.com/tapio/live-server">live-server</a></li>
      <li>Upload a file to your wok</li>
    </ul>

    <form id="fileupload" method="POST" enctype="multipart/form-data">
      <input id="fileinput" type="file" name="files[]" multiple>
      <br />
      <br />
      <input type="submit" value="Upload now!" />
    </form>
    <!-- It would be cool if you could link back to our page https://www.cloudwok.com
    either here or somewhere else on your page. Thanks!! -->
    <p style="font-size: x-small"><i>Upload service - powered by <a href="https://www.cloudwok.com">CloudWok</a></i></p>
    <div id="message"></div>


    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script>
      var wok_id = "ENTER_YOUR_WOK_ID"
      var jsonp_url = "https://www.cloudwok.com/api/rest/e/json/" + wok_id + "/details.json?callback=?";
      // retrieve quotas
      $.ajax({
        url: jsonp_url,
        dataType: "jsonp"
      }).then(function(resp) {
        availQuota = resp.availQuota;
        fileQuota = resp.fileQuota;
        // update the upload form
        $("#fileupload").attr("data-max-file-size", availQuota);
        $("#fileupload").attr("data-max-chunk-size", fileQuota);
      }, function(resp) {
        console.log("Whops. Cannot load widget, sorry. Is your wok-id correct?");
      });

      // upload file(s) when user clicks
      // on the submit button
      var cloudwok_upload_url = "https://www.cloudwok.com/api/rest/e/upload/" + wok_id;
      $(function() {
        $("#fileupload").submit(function() {
          if ($.support.cors) {
            $.ajax({
              url: cloudwok_upload_url,
              type: "OPTIONS"
            }).fail(function() {
              $("#message").html("<p>CloudWok server currently unavailable</p>");
            });
          }
          var data = new FormData();
          $.each(jQuery("#fileinput")[0].files, function(i, file) {
            data.append('file[]', file);
          });
          // POST request
          $.ajax({
            url: cloudwok_upload_url,
            data: data,
            cache: false,
            contentType: false,
            processData: false,
            type: 'POST',
          }).success(function() {
            $("#message").html("<p>File(s) uploaded. Yay!</p>");
          });

          return false;
        });
      });
    </script>
</body>

</html>
